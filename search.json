[
  {
    "objectID": "load_sim_stellar_catalog.html",
    "href": "load_sim_stellar_catalog.html",
    "title": "Module: Loading HACC stellar catalog",
    "section": "",
    "text": "galaxy_tag: Tags to galaxies given in the HACC datasets\nstellar idx: Unique ID for individual particles\nmetallicity: Fraction of the metals in the stellar particles (Not rescaled by Zsun)\nmass: Mass of the stellar particle in Msun units\nage: Age of the stellar particles in 1/H0 units\nx, y, z: Particle positions in Mpc/h units\nvx, vy, vz: Velocity of the particles\n\n\nsource\n\n\n\n\n load_hacc_galaxy_data\n                        (fileIn:str='../hydro_colors/data/test_hacc_stella\n                        r_catalog/Gals_Z0.txt',\n                        Z_solar:numpy.float32=0.019,\n                        H0:numpy.float32=71.0)\n\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\nfileIn\nstr\n../hydro_colors/data/test_hacc_stellar_catalog/Gals_Z0.txt\nInput galaxy catalog file from HACC hydro sim\n\n\nZ_solar\nfloat32\n0.019\nSolar metallicity\n\n\nH0\nfloat32\n71.0\nHubble constant\n\n\nReturns\ntuple\n\ngalaxy_tag, stellar_indices, metallicity, mass, age, x, y, z"
  },
  {
    "objectID": "load_sim_stellar_catalog.html#the-entries-in-the-current-stellar-catalog-are",
    "href": "load_sim_stellar_catalog.html#the-entries-in-the-current-stellar-catalog-are",
    "title": "Module: Loading HACC stellar catalog",
    "section": "",
    "text": "galaxy_tag: Tags to galaxies given in the HACC datasets\nstellar idx: Unique ID for individual particles\nmetallicity: Fraction of the metals in the stellar particles (Not rescaled by Zsun)\nmass: Mass of the stellar particle in Msun units\nage: Age of the stellar particles in 1/H0 units\nx, y, z: Particle positions in Mpc/h units\nvx, vy, vz: Velocity of the particles\n\n\nsource\n\n\n\n\n load_hacc_galaxy_data\n                        (fileIn:str='../hydro_colors/data/test_hacc_stella\n                        r_catalog/Gals_Z0.txt',\n                        Z_solar:numpy.float32=0.019,\n                        H0:numpy.float32=71.0)\n\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\nfileIn\nstr\n../hydro_colors/data/test_hacc_stellar_catalog/Gals_Z0.txt\nInput galaxy catalog file from HACC hydro sim\n\n\nZ_solar\nfloat32\n0.019\nSolar metallicity\n\n\nH0\nfloat32\n71.0\nHubble constant\n\n\nReturns\ntuple\n\ngalaxy_tag, stellar_indices, metallicity, mass, age, x, y, z"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "WaterColors",
    "section": "",
    "text": "pip install hydro_colors"
  },
  {
    "objectID": "index.html#installation",
    "href": "index.html#installation",
    "title": "WaterColors",
    "section": "",
    "text": "pip install hydro_colors"
  },
  {
    "objectID": "index.html#simple-implementation-to-hacc-hydro-data",
    "href": "index.html#simple-implementation-to-hacc-hydro-data",
    "title": "WaterColors",
    "section": "Simple implementation to HACC hydro data",
    "text": "Simple implementation to HACC hydro data\n\n1. First we import the following modules of hydro_colors\n\nimport hydro_colors as hc\nfrom hydro_colors.load_sim_stellar_catalog import load_hacc_galaxy_data\nfrom hydro_colors.calculate_csp import calc_fluxes_for_galaxy\nfrom hydro_colors.load_sps_library import STELLAR_LIBRARY_DIR\n\n\n\n2. Then the galaxy-star catalog from HACC is loaded\n\ngalaxy_star_catalog_file = '../hydro_colors/data/test_hacc_stellar_catalog/Gals_Z0_576.txt'\ngalaxy_tags, stellar_idx, _, _, _, x, y, z, _, _, _ = hc.load_sim_stellar_catalog.load_hacc_galaxy_data(galaxy_star_catalog_file)\n\n\n\n3. After selecting a unique galaxy tag, we calculate the SED. This is the rest-frame SED is due to spectral emission alone, and without dust attenuation.\n\ngalaxy_number = 4\nunique_galaxy_tag = np.unique(galaxy_tags)[galaxy_number]\nprint('Number of galaxies: %d'%np.unique(galaxy_tags).shape[0])\n\nspec_wave_ssp, spec_flux_ssp, spec_csp, flux_proxy, gal_stellar_mass = hc.calculate_csp.calc_fluxes_for_galaxy(galaxy_star_catalog_file,\n                                                                                                               unique_galaxy_tag,\n                                                                                                               STELLAR_LIBRARY_DIR)\n\nNumber of galaxies: 10\nLibrary shape:  (22, 94, 1963)\nWavelength shape:  (1963,)\n\n\n\n\n4. Finally, we plot SEDs from both SSPs and CSPs\n\nfig, a = plt.subplots(2,1, figsize=(14, 12), sharex=True, sharey=False)\nc_norm = mpl.colors.Normalize(vmin=np.min(flux_proxy), vmax=np.max(flux_proxy))\nc_map  = mpl.cm.coolwarm\n\ns_map  = mpl.cm.ScalarMappable(cmap=c_map, norm=c_norm)\ns_map.set_array([])\n\n\nfor idx in range(spec_flux_ssp.shape[0]):\n    \n    # spec_flux_ssp[idx] = spec_ssp(age_hydro[ssp_id], metal_hydro[ssp_id], mass[ssp_id])\n    a[0].plot(spec_wave_ssp, spec_flux_ssp[idx], \n              # color=s_map.to_rgba(np.log10(mass[ssp_id])), \n              color=s_map.to_rgba(flux_proxy[idx]), \n              alpha=0.5)\n\nfig.colorbar(s_map, ax = a[0], \n             orientation = 'horizontal', \n             # label=r'stellar mass', pad=0.2)\n             label=r'flux proxy', pad=0.2)\n    \n\n#####################################################################\n\na[1].plot(spec_wave_ssp, spec_csp)\n\n\n# a[0].set_ylim(1e-9, 1e-6)\n# a[0].set_yscale('log')\n# a[1].set_yscale('log')\n# a[1].set_xscale('log')\na[1].set_xlim(3e3, 1e4)\n\n\na[0].set_xlabel(r'${\\rm wavelength\\ [\\AA]}$', fontsize = 'x-large')\na[1].set_xlabel(r'${\\rm wavelength\\ [\\AA]}$', fontsize = 'x-large')\na[0].set_ylabel(r'$L_{\\rm SSP}(\\lambda)\\ {\\rm [L_{\\odot}/\\AA]}$', fontsize = 'x-large')\na[1].set_ylabel(r'$L_{\\rm CSP}(\\lambda)\\ {\\rm [L_{\\odot}/\\AA]}$', fontsize = 'x-large')\n\n\nplt.show()\n\n\n\n\n\n\nOne can also find luminosity profiles for the simulated galaxies\n\n1. First we project the luminosity on to grids\n\ngal_tag_cond = np.where(galaxy_tags == unique_galaxy_tag)\n\n# x_centered_scaled =  (x[gal_tag_cond] - np.min(x[gal_tag_cond]))/(np.max(x[gal_tag_cond]) - np.min(x[gal_tag_cond]))\n# y_centered_scaled =  (y[gal_tag_cond] - np.min(y[gal_tag_cond]))/(np.max(y[gal_tag_cond]) - np.min(y[gal_tag_cond]))\n\nx_centered_scaled =  (x[gal_tag_cond] - np.mean(x[gal_tag_cond]))/(np.max(x[gal_tag_cond]) - np.min(x[gal_tag_cond]))\ny_centered_scaled =  (y[gal_tag_cond] - np.mean(y[gal_tag_cond]))/(np.max(y[gal_tag_cond]) - np.min(y[gal_tag_cond]))\n\nnbins = 60\n\n\nxedges = np.linspace(x_centered_scaled.min(), x_centered_scaled.max(), nbins) \nyedges = np.linspace(y_centered_scaled.min(), y_centered_scaled.max(), nbins) \n\n\nH, xedges, yedges, binnumber = stats.binned_statistic_2d(x_centered_scaled, y_centered_scaled, \n                                                         None, 'count', bins=[xedges, yedges],\n                                                         expand_binnumbers=True)\n\n\ngrid_flux = np.zeros_like(H)\n\nfor idx, ssp_id in enumerate(gal_tag_cond[0]):\n    grid_flux[binnumber[:, idx][0]-1, binnumber[:, idx][1]-1] = np.trapz(spec_flux_ssp[idx], spec_wave_ssp)\n\n\n\n2. Next we plot the stellar density and luminosity profiles\n\nfig, ax = plt.subplots(1, 2, figsize=(14, 4))\nc_norm = mpl.colors.Normalize(vmin=1, vmax=np.max(H))\nc_map  = mpl.cm.coolwarm\n\n\nax[0].set_title('Particle binning')\n\nim = ax[0].imshow(H, interpolation='nearest', origin='lower', \n                extent=[xedges[0], xedges[-1], yedges[0], yedges[-1]], \n                cmap=c_map)\n\nfig.colorbar(im, ax = ax[0], \n             orientation = 'vertical', \n             # label=r'stellar mass', pad=0.2)\n             label=r'stellar density', pad=0.2)\n\n\n# Normalize the array vals so they can be mapped to a color\nc_norm = mpl.colors.Normalize(vmin=np.min(grid_flux.min()), vmax=np.max(grid_flux))\nc_norm = mpl.colors.Normalize(vmin=0.004, vmax=np.max(grid_flux))\n\n# # Pick a colormap\n# c_map  = mpl.cm.magma\n\n\nax[1].set_title('Luminosity profile')\nim = ax[1].imshow(grid_flux, interpolation='nearest', origin='lower', extent=[xedges[0], xedges[-1], yedges[0], yedges[-1]], cmap=c_map)\n\n# Adding the colorbar\nfig.colorbar(im, ax = ax[1], \n             orientation = 'vertical', \n             # label=r'stellar mass', pad=0.2)\n             label=r'Luminosity', pad=0.2)\n\n\nax[0].set_xlabel('x[Mpc]')\nax[0].set_ylabel('y[Mpc]')\nax[1].set_xlabel('x[Mpc]')\nax[1].set_ylabel('y[Mpc]')\n\nax[0].set_aspect('equal', adjustable='box')\nax[1].set_aspect('equal', adjustable='box')\n\n\nplt.show()\n\n\n\n\n\n\n\nRadial mass profile of the galaxy\n\ndef cart2pol(x, y):\n    rho = np.sqrt(x**2 + y**2)\n    phi = np.arctan2(y, x)\n    return(rho, phi)\n\nradius, azimut = cart2pol(x_centered_scaled, y_centered_scaled)\nazimut += np.pi\n\n# define binning\nrbins = np.linspace(0,radius.max(), 20)\nabins = np.linspace(0,2*np.pi, 2)\n\n\nsubdivs = 40\nabins2 = np.linspace(0, 2 * np.pi, (len(abins) - 1) * subdivs + 1)\n\n\n\n#calculate histogram for mass density\n# hist, _, _ = np.histogram2d(azimut, radius, bins=(abins, rbins))\nhist, _, _, binnumbers = stats.binned_statistic_2d(azimut, radius, \n                                                         None, 'count', bins=[abins, rbins],\n                                                         expand_binnumbers=True)\n\n\n# Luminosity\ngrid_flux_polar = np.zeros_like(hist)\n\nfor idx, ssp_id in enumerate(gal_tag_cond[0]):\n    grid_flux_polar[binnumbers[:, idx][0]-1, binnumbers[:, idx][1]-1] = np.trapz(spec_flux_ssp[idx], spec_wave_ssp)\n    \n    \n    \n\nA, R = np.meshgrid(abins, rbins)\nA2, R2 = np.meshgrid(abins2, rbins)\n\n# plot\n\nfig = plt.figure(figsize=(14 , 14))\nax0 = plt.subplot(221, projection=\"polar\")\nax1 = plt.subplot(222)\n\n# pc = ax.pcolormesh(A, R, hist.T, cmap=\"magma_r\")\npc2 = ax0.pcolormesh(A2, R2, np.repeat(hist.T, subdivs, axis=1), cmap='gist_heat_r')\npc3 = ax0.scatter(azimut, radius, alpha=1, marker='o', s=1, color='k')\nfig.colorbar(pc2, ax=ax0)\n\nax1.plot(0.5*(rbins[1:] + rbins[:-1]), np.sum(hist, axis=0));\nax1.set_xlabel('Normalized radius')\nax1.set_ylabel('Density')\n\n\nax2 = plt.subplot(223, projection=\"polar\")\nax3 = plt.subplot(224)\n\n# pc = ax.pcolormesh(A, R, hist.T, cmap=\"magma_r\")\npc3 = ax2.pcolormesh(A2, R2, np.repeat(grid_flux_polar.T, subdivs, axis=1), cmap='gist_heat_r')\npc4 = ax2.scatter(azimut, radius, alpha=1, marker='o', s=1, color='k')\nfig.colorbar(pc3, ax=ax2)\n\nax3.plot(0.5*(rbins[1:] + rbins[:-1]), np.sum(grid_flux_polar, axis=0));\nax3.set_xlabel('Normalized radius')\nax3.set_ylabel('Luminosity')\n\n/tmp/ipykernel_2275932/3123066502.py:45: MatplotlibDeprecationWarning: Auto-removal of grids by pcolor() and pcolormesh() is deprecated since 3.5 and will be removed two minor releases later; please call grid(False) first.\n  pc2 = ax0.pcolormesh(A2, R2, np.repeat(hist.T, subdivs, axis=1), cmap='gist_heat_r')\n/tmp/ipykernel_2275932/3123066502.py:58: MatplotlibDeprecationWarning: Auto-removal of grids by pcolor() and pcolormesh() is deprecated since 3.5 and will be removed two minor releases later; please call grid(False) first.\n  pc3 = ax2.pcolormesh(A2, R2, np.repeat(grid_flux_polar.T, subdivs, axis=1), cmap='gist_heat_r')\n\n\nText(0, 0.5, 'Luminosity')"
  },
  {
    "objectID": "index.html#under-the-hood",
    "href": "index.html#under-the-hood",
    "title": "WaterColors",
    "section": "Under the hood",
    "text": "Under the hood\n\nfrom hydro_colors.load_sps_library import *\nfrom hydro_colors.load_sim_stellar_catalog import *\n\n\nspec_flux, spec_wave = load_fsps_spectral_library()\nage_fsps_gyr, Z_padova_fsps = load_fsps_age_metallicity()\ngal_tag, stellar_idx, metal_hydro, mass, age_hydro, x, y, z, vx, vy, vz = load_hacc_galaxy_data()\n\n\nf, a = plt.subplots(1,2, figsize=(14, 3))\na[0].hist(metal_hydro, bins = 100, histtype='step', lw=5, label='Z=0 hydro');\n[a[0].axvline(_x, linewidth=1, color='r', alpha=0.5) for _x in Z_padova_fsps];\na[0].legend()\na[0].set_xlabel('log(z/zsol)')\n\n\na[1].hist(age_hydro, bins = 100, histtype='step', lw=5, label='Z=0 hydro');\n[a[1].axvline(_x, linewidth=1, color='r', alpha=0.5) for _x in age_fsps_gyr];\na[1].legend()\na[1].set_xlabel('age')\n\nplt.show()\n\nLibrary shape:  (22, 94, 1963)\nWavelength shape:  (1963,)"
  },
  {
    "objectID": "ssp_interpolation.html",
    "href": "ssp_interpolation.html",
    "title": "Module: Interpolation routines for SSP",
    "section": "",
    "text": "source\n\nspec_ssp_lookup\n\n spec_ssp_lookup (age_hydro_i:numpy.float32=None,\n                  metal_hydro_i:numpy.float32=None,\n                  mass_hydro_i:numpy.float32=None,\n                  age_fsps:numpy.float32=None,\n                  z_padova_fsps:numpy.float32=None, spec_flux:&lt;built-\n                  infunctionarray&gt;=None, spec_wave:&lt;built-\n                  infunctionarray&gt;=None)\n\nLookup table for finding the closest SPS entry to HACC SSP\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\nage_hydro_i\nfloat32\nNone\nAge of the HACC stellar particle\n\n\nmetal_hydro_i\nfloat32\nNone\nMetallicity of the stellar particle\n\n\nmass_hydro_i\nfloat32\nNone\nMass of the stellar particle\n\n\nage_fsps\nfloat32\nNone\nAges in SPS library\n\n\nz_padova_fsps\nfloat32\nNone\nMetallicities in SPS library\n\n\nspec_flux\narray\nNone\nStellar library SEDs\n\n\nspec_wave\narray\nNone\nStellar library wavelengths\n\n\nReturns\ntuple\n\nSSP Wavelength, SSP Luminosity"
  },
  {
    "objectID": "dust_attenuation.html",
    "href": "dust_attenuation.html",
    "title": "Module: Dust attenuation",
    "section": "",
    "text": "# galaxy_star_catalog_file = '../hydro_colors/data/test_hacc_stellar_catalog/Gals_Z0.txt'\n# galaxy_star_catalog_file = '../hydro_colors/data/test_hacc_stellar_catalog/Gals_Z0_576.txt'\n\n# np.loadtxt(galaxy_star_catalog_file, skiprows=1, unpack=True).shape"
  },
  {
    "objectID": "load_sps_library.html",
    "href": "load_sps_library.html",
    "title": "Module: Loading spectral library",
    "section": "",
    "text": "source\n\nload_fsps_spectral_library\n\n load_fsps_spectral_library\n                             (dirIn:str='../hydro_colors/data/sps_library_\n                             data/')\n\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\ndirIn\nstr\n../hydro_colors/data/sps_library_data/\nInput directory of the stellar spectra library\n\n\nReturns\ntuple\n\nFluxes, wavelengths\n\n\n\n\nsource\n\n\nload_fsps_age_metallicity\n\n load_fsps_age_metallicity\n                            (dirIn:str='../hydro_colors/data/sps_library_d\n                            ata/', Z_solar:numpy.float32=0.019)\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\ndirIn\nstr\n../hydro_colors/data/sps_library_data/\n\n\n\nZ_solar\nfloat32\n0.019\nSolar metallicity in Padova\n\n\nReturns\ntuple\n\nAge in Gyr, Metallicity in Z/Z_sun"
  },
  {
    "objectID": "calculate_csp.html",
    "href": "calculate_csp.html",
    "title": "Module: Compute CSF flux",
    "section": "",
    "text": "source\n\nssp_to_csp\n\n ssp_to_csp (spec_flux_ssp:numpy.ndarray)\n\n\n\n\n\nType\nDetails\n\n\n\n\nspec_flux_ssp\nndarray\nSSP SEDs\n\n\nReturns\narray\nCSP SED\n\n\n\n\nsource\n\n\ngalaxy_stellar_mass\n\n galaxy_stellar_mass (selected_star_masses:&lt;built-infunctionarray&gt;)\n\n\n\n\n\nType\nDetails\n\n\n\n\nselected_star_masses\narray\nSSP masses in a galaxy\n\n\nReturns\nfloat32\nTotal stellar mass of the galaxy\n\n\n\n\nsource\n\n\ntotal_luminosity\n\n total_luminosity (spec_flux_ssp:numpy.ndarray, spec_wave:&lt;built-\n                   infunctionarray&gt;)\n\n\n\n\n\nType\nDetails\n\n\n\n\nspec_flux_ssp\nndarray\nSSP SEDs\n\n\nspec_wave\narray\nSED Wavelength\n\n\nReturns\nfloat32\nLuminosity\n\n\n\n\nsource\n\n\ncalc_fluxes_for_galaxy\n\n calc_fluxes_for_galaxy (gal_file_in:str='../hydro_colors/data/test_hacc_s\n                         tellar_catalog/Gals_Z0.txt',\n                         unique_gal_tag:numpy.float32=None, spectral_libra\n                         ry_path:str='../hydro_colors/data/sps_library_dat\n                         a/')\n\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\ngal_file_in\nstr\n../hydro_colors/data/test_hacc_stellar_catalog/Gals_Z0.txt\nHACC stellar catalog\n\n\nunique_gal_tag\nfloat32\nNone\nSelected galaxy tag\n\n\nspectral_library_path\nstr\n../hydro_colors/data/sps_library_data/\nSpectral library path\n\n\nReturns\ntuple\n\nSED wavelength, individual SSP SEDs, CSP SED, Luminosity, Galaxy stellar mass"
  }
]